GoodCheck - блокчек-скрипт для Zapret

Автор:
Ori

Условия распространения:
Без ограничений для некоммерческого использования, с указанием авторства.

--------------

Принцип работы скрипта очень прост:
- Берутся стратегии из текстового листа, расположенного в папке Strategies.
- Запускается Zapret с каждой стратегией по очереди.
- Для каждой стратегии выполняется набор тестов TCP 16-20: Curl делает GET-запросы к 18 заранее выбранным доменам (Cloudflare, Hetzner, OVH, Oracle, AWS, Fastly, Akamai и др.) с уникальным параметром ?t=случайное.
- Каждый запрос ограничен по времени (по умолчанию 5 секунд) и завершает скачивание после первых 64 КиБ данных. Если порог достигнут — тест считается успешным, если сработал таймаут — фиксируется блокировка (с установившимся HTTP-кодом или без него), меньший объём данных отмечается как «возможно блокируется».
- Результаты анализируются и сортируются. Увидеть все подробности можно в логе в папке Logs.

--------------

Инструкции по базовой настройке:
- Распаковываете архив в отдельную папку.
- Открываете файл Config.cmd с помощью блокнота.
- Указываете путь к папке с Zapret в соответствующей переменной. Пример:
set "_zapretFolderOverride=D:\Soft\Zapret\"
- Сохраняете.

Примечание: Старайтесь не использовать пути с пробелами, русскими буквами или спецсимволами. Это может привести к ошибкам.
Примечание 2: Допускается использование относительных путей.
Примечание 3: Если положить скрипт в папку с программой обхода, он найдет её самостоятельно.

--------------

Инструкции по базовому использованию:

- Запускаете скрипт через Start.cmd.
- Выбираете список стратегий для проверки.
- Указываете количество проходов (повторов) — каждый проход прогоняет весь набор TCP 16-20 тестов.
- Дожидаетесь окончания проверки и смотрите результаты в файле лога, автоматически созданном в папке Logs.

--------------

Инструкции по дополнительным функциям:

- Таймаут и порог успешного скачивания для набора TCP 16-20 можно изменить через параметры в Config.cmd: set "_tcp1620TimeoutMs=6000" (миллисекунды) и set "_tcp1620OkThresholdBytes=65536" (байты).
- При необходимости можно добавить свой тест к набору TCP 16-20 — задайте идентификатор, провайдера, URL и число повторов через set "_tcp1620CustomId=...", set "_tcp1620CustomProvider=...", set "_tcp1620CustomUrl=...", set "_tcp1620CustomTimes=...".
- Минимальный таймаут запросов Curl по умолчанию - 2 секунды. Это число можно снизить (не рекомендуется из-за резко роста false-negative результатов) или, наоборот, повысить (например, если у вас медленный интернет). Принимаются только целочисленные положительные значения. Параметр в конфиге, в секундах: set "_curlMinTimeout=5"
- Через set "_curlExtraKeys=" можно установить дополнительные ключи для Curl. Например, прописав что-то вроде "_curlExtraKeys=--resolve x.com:443:104.244.42.65 --resolve instragram.com:443:31.13.72.174" Можно сымитировать эффект файла etc/hosts. Полный списко ключей для Curl ищите в их офицциальной документации.
- Существует возможность вывода наиболее успешных стратегий в отдельный файл, для тех кому лень читать лог или тех, кто хочет использовать их автоматически со сторонними скриптами. По умолчанию выключено. Включить: set "_outputMostSuccessfulStrategiesSeparately=true"
- Имя для файла наиболее удачных стратегий. По умолчанию MostSuccessfulStrategies_ProgramName.txt, где ProgramName - имя использовавшейся для проверки программы. Изменить на своё: set "_mostSuccessfulStrategiesFile=Best.txt"
 - Для стратегий работает автоподстановка. Например, FAKEHEX в файле стратегий автоматически заменяется на www.google.com. А пэйлоады заменяются на те, что лежат в папке Payloads. Для автоподстановок можно установить свои значения:
    > для фейкового SNI: set "_fakeSNI=
    > для фейкового hex в формате шестнадцетиричного потока: set "_fakeHexRaw=
    > для фейкового hex в формате байтовом формат: set "_fakeHexBytes="
    > для фейкового TLS пэйлоада: set "_payloadTLS="
    > для фейкового QUIC (UDP) пэйлоада: set "_payloadQuic=
 - Если при запуске появляется предупреждение об отсутствующей папке Payloads, создайте её рядом со скриптом и скопируйте туда нужные файлы. По умолчанию GoodCheck ожидает найти как минимум tls_earth_google_com.bin и quic_ietf_www_google_com.bin из дистрибутива Zapret (каталог payloads). Эти пэйлоады задействуются только в стратегиях с маркерами PAYLOADTLS/PAYLOADQUIC и не влияют на выполнение TCP 16-20 проверки.
- В файлах стратегий строчки можно комментировать знаком /
- В файлах стратегий первые две незакомментированные строки зарезервированны:
 > В строке _strategyExtraKeys# указываются ключи, которые будут применены ко всем стратегиям в списке.
 > В строке _strategyCurlExtraKeys# указываются ключи, которые будут использованы для Curl'а при использовании данного листа.

--------------
